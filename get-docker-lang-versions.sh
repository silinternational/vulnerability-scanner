#!/bin/bash

printf 'Docker image,PHP version,NodeJS version,Python version\n' >> docker-lang-versions.txt

while IFS= read -r line; do
  docker run --rm --entrypoint php "$line" -v &>/dev/null
  if [ $? -eq 0 ]; then
    phpVersion=$(docker run --rm --entrypoint php "$line" -r "echo PHP_MAJOR_VERSION . '.' . PHP_MINOR_VERSION;")
  else
    phpVersion="NONE"
  fi
  
  docker run --rm --entrypoint node "$line" -v &>/dev/null
  if [ $? -eq 0 ]; then
    nodeVersion=$(docker run --rm --entrypoint node "$line" -e "console.log(process.version.match(/^v?(\d+\.\d+)\./)[1])")
  else
    nodeVersion="NONE"
  fi
  
  docker run --rm --entrypoint python "$line" --version &>/dev/null
  if [ $? -eq 0 ]; then
    pythonVersion=$(docker run --rm --entrypoint python "$line" -c 'import sys; print(str(sys.version_info[0])+"."+str(sys.version_info[1]))')
  else
    pythonVersion="NONE"
  fi
  
  printf '%s,%s,%s,%s\n' "$line" "$phpVersion" "$nodeVersion" "$pythonVersion" >> docker-lang-versions.txt
done
