
/**
 * Get a list of information about the (production) dependencies specified in
 * the provided JSON string from a package-lock.json file.
 *
 * @param {string} packageLockContents
 * @returns {undefined | {name: string, version: string}[]}
 */
const getDependenciesFromPackageLock = packageLockContents => {
  if (!packageLockContents) {
    return undefined
  }
  const packageLockData = JSON.parse(packageLockContents)
  if (!packageLockData.hasOwnProperty('dependencies')) {
    return undefined
  }
  const dependencyNames = Object.keys(packageLockData.dependencies)
  const prodDependencyNames = dependencyNames.filter(dependencyName => {
    return !packageLockData.dependencies[dependencyName].dev
  })
  return prodDependencyNames.map(dependencyName => ({
    name: dependencyName,
    version: packageLockData.dependencies[dependencyName].version
  }))
}

module.exports = {
  getDependenciesFromPackageLock,
}
