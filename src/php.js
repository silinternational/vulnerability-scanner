
/**
 * A list of End-Of-Life (EOL) dates, formatted as yyyy-mm-dd strings, for the
 * known major.minor PHP versions.
 *
 * @type {Object}
 */
const eolDatesByVersion = {
  '7.2': '2020-11-30'
}

/**
 * Extract the major.minor version string for the given full PHP version string.
 *
 * @param {string} phpVersion -- Example: 7.2.24-0ubuntu0.18.04.7
 * @returns {string} -- Example: 7.2
 */
const getMajorMinorVersion = phpVersion => {
  const sections = phpVersion.split('.')
  const major = sections[0]
  const minor = sections[1]
  return `${major}.${minor}`
}

/**
 * Indicate whether the specified version has already reach End-Of-Life (EOL).
 *
 * @param {string} majorMinorVersion -- Example: 7.2
 * @param {string} currentDate -- The current date, as a yyyy-mm-dd string.
 * @returns {boolean|undefined}
 */
const isVersionEOL = (majorMinorVersion, currentDate) => {
  const eolDate = eolDatesByVersion[majorMinorVersion]
  if (!eolDate) {
    return undefined
  }
  return currentDate > eolDate
}

module.exports = {
  getMajorMinorVersion,
  isVersionEOL
}
