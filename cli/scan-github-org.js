const dotenv = require('dotenv')
const { getSecurityVulnerabilitiesForGitHubOrg } = require('../index')
const { writeToCsv } = require('../src/csv')

dotenv.config()
const githubToken = process.env.GITHUB_TOKEN

const githubOrg = process.argv[2]
if (!githubOrg) {
  console.error('Please specify a GitHub organization')
  process.exitCode = 1;
} else {
  const versionsCsvUrl = process.argv[3] || ''
  getSecurityVulnerabilitiesForGitHubOrg(
    githubToken,
    githubOrg,
    versionsCsvUrl
  ).then(writeToCsv)
}
