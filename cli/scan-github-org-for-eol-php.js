const dotenv = require('dotenv')
const { getPhpVersionVulnerabilitiesOfGitHubOrg } = require('../index')
const { writeToCsv } = require('../src/csv')

dotenv.config()

const githubToken = process.env.GITHUB_TOKEN

const githubOrg = process.argv[2]
const versionsCsvUrl = process.argv[3]

if (!githubOrg) {
  console.error('Please specify a GitHub organization')
  process.exitCode = 1;
} else if (!versionsCsvUrl) {
  console.error('Please provide a URL for a CSV of PHP versions used in Docker images')
  process.exitCode = 1;
} else {
  const versionsCsvUrl = process.argv[3] || ''
  getPhpVersionVulnerabilitiesOfGitHubOrg(
    githubToken,
    githubOrg,
    versionsCsvUrl
  ).then(writeToCsv)
}
