const dotenv = require('dotenv')
const { getSecurityVulnerabilitiesForBitbucketRepo } = require('../index')

dotenv.config()

const username = process.env.BITBUCKET_USERNAME
const appPassword = process.env.BITBUCKET_APP_PASSWORD
const githubToken = process.env.GITHUB_TOKEN
const repo = process.argv[2]

if (!username) {
  console.error('Please provide a BITBUCKET_USERNAME environment variable')
  process.exitCode = 1;
} else if (!appPassword) {
  console.error('Please provide a BITBUCKET_APP_PASSWORD environment variable')
  process.exitCode = 1;
} else if (!githubToken) {
  console.error('Please provide a GITHUB_TOKEN environment variable')
  process.exitCode = 1;
} else if (!repo) {
  console.error('Please specify a Bitbucket repo in the form "workspace/repo-slug"')
  process.exitCode = 1;
} else {
  getSecurityVulnerabilitiesForBitbucketRepo(
    username,
    appPassword,
    githubToken,
    repo
  ).then(console.log)
}
