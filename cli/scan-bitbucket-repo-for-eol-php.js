const dotenv = require('dotenv')
const { getPhpVersionVulnerabilitiesOfBitbucketRepo } = require('../index')

dotenv.config()

const username = process.env.BITBUCKET_USERNAME
const appPassword = process.env.BITBUCKET_APP_PASSWORD

const repo = process.argv[2]
const versionsCsvUrl = process.argv[3]

if (!username) {
  console.error('Please provide a BITBUCKET_USERNAME environment variable')
  process.exitCode = 1;
} else if (!appPassword) {
  console.error('Please provide a BITBUCKET_APP_PASSWORD environment variable')
  process.exitCode = 1;
} else if (!repo) {
  console.error('Please specify a Bitbucket repo in the form "workspace/repo-slug"')
  process.exitCode = 1;
} else if (!versionsCsvUrl) {
  console.error('Please provide a URL for a CSV of PHP versions used in Docker images')
  process.exitCode = 1;
} else {
  getPhpVersionVulnerabilitiesOfBitbucketRepo(
    username,
    appPassword,
    repo,
    versionsCsvUrl
  ).then(console.log)
}
