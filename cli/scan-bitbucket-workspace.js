const dotenv = require('dotenv')
const { getSecurityVulnerabilitiesForBitbucketWorkspace } = require('../index')

dotenv.config()

const username = process.env.BITBUCKET_USERNAME
const appPassword = process.env.BITBUCKET_APP_PASSWORD
const githubToken = process.env.GITHUB_TOKEN
const workspace = process.argv[2]

if (!username) {
  console.error('Please provide a BITBUCKET_USERNAME environment variable')
  process.exitCode = 1;
} else if (!appPassword) {
  console.error('Please provide a BITBUCKET_APP_PASSWORD environment variable')
  process.exitCode = 1;
} else if (!githubToken) {
  console.error(
    'Please provide a GITHUB_TOKEN environment variable to check for security vulnerabilities'
  )
  process.exitCode = 1;
} else if (!workspace) {
  console.error('Please specify a Bitbucket workspace')
  process.exitCode = 1;
} else {
  getSecurityVulnerabilitiesForBitbucketWorkspace(
    username,
    appPassword,
    githubToken,
    workspace
  ).then(console.log)
}
